LVIP-0002： 冷火石机制

<pre>
LVIP-0002：
LVIP: 0002
Title: A Proposal for Cold Firestone
Author: lavatech
Status: Draft
Type: Protocol
Created: 2019-10-22
Superseded-By: None
</pre>

==概述==
LVIP-0002建议了一种允许用户预先构造花费火石的交易，即冷火石。

该机制下，用户可以购买火石到自己的地址，并在购买火石交易的基础上构造下一笔花费火石的交易。该机制可以实现的效果是，用户不再需要将火石购买到他人地址上，也可以让他人花费该火石。

该机制的目的是保护用户资金安全，让火石机制更加去中心化和去信任化。

冷火石的运行过程可被拆解为：先由火石购买者将购买的火石“加工”为冷火石并发送给实际使用者，火石使用者“装填”冷火石使其进入待用状态。

==动机==
本方案的动机来自现有火石机制在设计上的缺陷。

假设Alice有一个地址Addr-A，Bob有一个地址Addr-B，且双方都持有自己地址的私钥。

假设Alice是持有LV资金的普通用户，而Bob是矿工。Alice和Bob协商，由Alice给Bob的地址Addr-B购买一个火石（使用buyfirestone命令）。这样如果Bob成功打包了区块，Bob就可以使用这个火石，抵押资金返还到Bob的地址Addr-B；如果Bob没有在火石过期前成功打包区块，就需要手工释放火石并归还抵押的资金（使用freefirestone命令）。

这种现有机制可以允许矿工利用他人的资金购买并使用火石。对于资金富余但是不挖矿的用户，也可以通过提供火石获取一定的收益。因此，这是一个可以满足供需双方需要的双赢机制，是有益的。

但是，该机制是有风险的，即Alice给Bob购买火石后，由于火石是在Bob的地址上，那么相当于Alice已经失去了对火石的控制权。当火石被使用或者过期后，都必须由Bob手动操作释放或者归还释放后的资金至Alice的地址。因此，这一机制必须在Alice信任Bob的前提下才能有效地运行。

==改进设想：冷火石==
由上述问题，作者提出一个可以避免信任问题和安全问题的改进方案，称之为“冷火石”。

在介绍新的设想之前，有必要概述现有火石机制的技术要点。

用户购买火石时，实际上是生成了一笔交易（暂且称其为“购买火石的交易”），并向全网广播、打包上链。并且，无论用户是给自己的地址购买，还是给他人的地址购买，从技术的角度来说都是同样的交易结构，只是Output所写解锁条件内含的地址不同而已。

矿工挖矿时，如果成功铸造区块，矿工可以在构造Coinbase交易以外，再引用某个“购买火石的交易”并构造一笔花费火石的TX（暂且称其为“花费火石的交易”）。该交易的存在可使得Coinbase交易判定挖矿奖励翻倍，同时释放火石冻结的LV回到火石所在的地址。

而在冷火石的设想中，Alice直接向自己的地址购买火石，形成一笔“购买火石的交易”并广播，再引用该交易直接构造出后续“花费火石的交易”。

在构造后续“花费火石的交易”时，Alice会对交易用自己私钥完成签名，因此该交易实质上是“Anybody can spend”状态。

Alice构造完成该笔“花费火石的交易”后，并不广播这笔交易，而是将交易的原始数据（hex格式）发送给Bob。这一交易数据称之为“冷火石”，可以理解为是“准备好待用的火石”。

在整个过程中，Alice根本无需将火石购买到Bob的地址，Bob也根本无需对冷火石进行任何签名操作，因此自己的资金不会面临被Bob侵吞、强占或转移的风险。如果Bob最终没有能够花费掉冷火石，Alice可以自行使用freefirestone命令释放火石并取得抵押资金。

综上，冷火石可以很好地解决在给他人买火石时，需要信任成本和资金无法归还的问题，火石机制可以更加去中心化。

==冷火石的技术实现==
待补充

==冷火石机制的运行过程==
# Alice使用buyfirestone命令给自己的地址购买火石，生成“购买火石的交易”，并广播。
# Alice使用signfirestone命令构造出后续“花费火石的交易”（后文的“加工冷火石”），不广播。
# Alice将冷火石发送给Bob。
# Bob使用importfirestone命令将冷火石转入自己的挖矿节点，使挖矿节点能够辨认和花费冷火石（后文的“装填冷火石”）。
# 如果Bob成功出块，花费冷火石得到双倍挖矿奖励，冷火石抵押的资金自动返回Alice的地址；如果Bob没有在有效期内花费冷火石，Alice使用freefirestone命令释放火石抵押的资金返回自己的地址。

==加工冷火石==
Alice通过signfirestone命令将已购买的火石加工为冷火石。

*功能说明：用户指定一枚已购买的火石，加工得到一枚冷火石。
*参数1： Address，指已经购买了火石的地址，在此例中就是Alice自己的地址。必须保证钱包中有该地址的私钥，方可进行冷火石签名。
*参数2：TXID，是指 “购买火石的交易”的TXID。
*返回值：FSTX，是指构造完成“花费火石的交易”后的交易内容，以hex形式表现，也可以理解为就是冷火石的本体。

==装填冷火石==
Bob接受冷火石后，需要进行装填操作，使自己的挖矿节点可以辨认并花费这枚冷火石。

*功能说明：将接收到的冷火石（以hex格式体现）输入挖矿节点，使得挖矿节点可以辨认并花费冷火石。
*参数1：FSTX，冷火石的hex字节串。
*返回值： true|false：如果装填成功，返回true，否则返回false。

==参考资料==
[1]:https://github.com/lavafy/testnet/blob/master/Lava-Firestone-Guide-CN.md
[2]:https://github.com/lavaio/lvips/blob/master/lvip-0001.mediawiki

==历史==
# lavatech编写提交。

==修改记录==
# 2019-10-22：文档发布 By lavatech 
